<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modify Templates</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container">
    <h1 class="text-center mt-5">Modify Templates</h1>
    <div class="text-center">
        <a href="{{ url_for('landing') }}" class="btn btn-secondary mt-3">Back to Landing Page</a>
    </div>
</div>
<div class="container mt-5">
    <h2>Existing Templates</h2>
    <table class="table" id="templatesTable">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">Template Name</th>
            <th scope="col">Document Type</th>
            <th scope="col">Prompt</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<!-- Edit Template Modal -->
<div class="modal fade" id="editTemplateModal" tabindex="-1" aria-labelledby="editTemplateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editTemplateModalLabel">Edit Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editTemplateForm">
                    <input type="hidden" id="editTemplateId">
                    <div class="mb-3">
                        <label for="editTemplateName" class="form-label">Template Name</label>
                        <input type="text" class>
                        <input type="text" class="form-control" id="editTemplateName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDocumentType" class="form-label">Document Type</label>
                        <select class="form-select" id="editDocumentType" required>
                            <option value="">Choose...</option>
                            <option value="Invoice">Invoice</option>
                            <option value="Purchase Order">Purchase Order</option>
                            <option value="Receipt">Receipt</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editPrompt" class="form-label">Prompt</label>
                        <input type="text" class="form-control" id="editPrompt" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
  $(document).ready(function () {
    loadTemplates();
  });

  function loadTemplates() {
    $.ajax({
      url: "/get_templates",
      type: "GET",
      success: function (response) {
        const templates = response.templates;
        $("#templatesTable tbody").empty();
        for (const template of templates) {
          const row = createTemplateRow(template);
          $("#templatesTable tbody").append(row);
        }
      },
      error: function (response) {
        showAlert(response.responseJSON.message, "danger");
      },
    });
  }

  function createTemplateRow(template) {
    const row = $("<tr></tr>");
    row.append($("<td></td>").text(template.id));
    row.append($("<td></td>").text(template.name));
    row.append($("<td></td>").text(template.document_type));
    row.append($("<td></td>").text(template.prompt));

    const editButton = $("<button></button>").addClass("btn btn-sm btn-primary").text("Edit");
    editButton.click(() => editTemplate(template.id));

    const deleteButton = $("<button></button>").addClass("btn btn-sm btn-danger").text("Delete");
    deleteButton.click(() => deleteTemplate(template.id));

    const buttonGroup = $("<td></td>").append(editButton).append(" ").append(deleteButton);
    row.append(buttonGroup);

    return row;
  }

  function editTemplate(templateId) {
    window.location.href = "/edit_template/" + templateId;
  }

  function deleteTemplate(templateId) {
    if (confirm("Are you sure you want to delete this template?")) {
      $.ajax({
        url: "/delete_template/" + templateId,
        type: "DELETE",
        success: function (response) {
          showAlert("Template deleted successfully", "success");
          loadTemplates();
        },
        error: function (response) {
          showAlert(response.responseJSON.message, "danger");
        },
      });
    }
  }

  function showAlert(message, alertType) {
    $("#alertBox").html(message).addClass(`alert-${alertType}`).removeClass("d-none");
    setTimeout(function () {
      $("#alertBox").addClass("d-none").removeClass(`alert-${alertType}`);
    }, 3000);
  }
</script>
</body>
</html>